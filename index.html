<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VirginAI - AI Student Assistant</title>

<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #141E30, #243B55);
    color: white;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.container {
    width: 100%;
    max-width: 500px;
    background: rgba(255,255,255,0.05);
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 0 25px rgba(0,0,0,0.4);
    display: flex;
    flex-direction: column;
    height: 80vh;
}

h1 {
    text-align: center;
    color: #00c6ff;
    margin-bottom: 10px;
}

#chat {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 12px;
    background: rgba(0,0,0,0.2);
}

.user-msg, .ai-msg {
    margin: 8px 0;
    padding: 10px;
    border-radius: 12px;
    word-wrap: break-word;
    white-space: pre-wrap; /* multi-line support */
}

.user-msg {
    background: #00c6ff66;
    align-self: flex-end;
}

.ai-msg {
    background: #4444ff55;
    align-self: flex-start;
}

textarea {
    width: 100%;
    padding: 10px;
    border-radius: 10px;
    resize: vertical;
    font-size: 15px;
    outline: none;
    border: none;
    min-height: 50px;
    max-height: 120px;
}

button {
    margin-top: 10px;
    padding: 12px;
    border-radius: 10px;
    border: none;
    background: #00c6ff;
    color: white;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
}

button:hover {
    background: #009edc;
}

.loading {
    display: inline-block;
}
.loading::after {
    content: '.';
    animation: dots 1s steps(5,end) infinite;
}
@keyframes dots {
    0%,20%{content:'.';}
    40%{content:'..';}
    60%{content:'...';}
    80%,100%{content:'.';}
}

.clear-btn {
    margin-top: 5px;
    padding: 8px;
    border-radius: 8px;
    border: none;
    background: #ff5555;
    color: white;
    cursor: pointer;
    font-size: 14px;
}
.clear-btn:hover { background: #dd0000; }
</style>
</head>

<body>

<div class="container">
    <h1>ü§ñ VirginAI</h1>
    <div id="chat"></div>
    <textarea id="question" placeholder="Ask your question..." rows="2"></textarea>
    <button onclick="askAI()">Ask</button>
    <button class="clear-btn" onclick="clearChat()">Clear Chat</button>
</div>

<script>
const chat = document.getElementById("chat");
const questionInput = document.getElementById("question");

function appendMessage(msg, className){
    const div = document.createElement("div");
    div.className = className;
    div.textContent = msg;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

async function askAI(){
    const question = questionInput.value.trim();
    if(!question) return;

    appendMessage(question, "user-msg");
    questionInput.value = "";

    const loadingDiv = document.createElement("div");
    loadingDiv.className = "ai-msg loading";
    loadingDiv.textContent = "Thinking";
    chat.appendChild(loadingDiv);
    chat.scrollTop = chat.scrollHeight;

    try{
        const res = await fetch("/ask", {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body: JSON.stringify({question})
        });

        const data = await res.json();
        loadingDiv.remove();

        appendMessage(data.answer, "ai-msg");
    } catch(err){
        loadingDiv.remove();
        appendMessage("üåê Network or server error.", "ai-msg");
    }
}

// Clear chat & session on server
async function clearChat(){
    chat.innerHTML = "";
    await fetch("/clear-session", {method:"POST"});
}
</script>

</body>
</html>