<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VirginAI - AI Student Assistant</title>

<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #141E30, #243B55);
    color: white;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.container {
    width: 100%;
    max-width: 500px;
    background: rgba(255,255,255,0.05);
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 0 25px rgba(0,0,0,0.4);
    display: flex;
    flex-direction: column;
    height: 80vh;
}

h1 {
    text-align: center;
    color: #00c6ff;
    margin-bottom: 10px;
}

#chat {
    flex: 1;
    overflow-y: auto; /* Chat area scrolling */
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 12px;
    background: rgba(0,0,0,0.2);
    /* Ensure content with newlines wraps correctly */
    white-space: pre-wrap; 
}

.user-msg, .ai-msg {
    margin: 8px 0;
    padding: 10px;
    border-radius: 12px;
    word-wrap: break-word;
    /* Crucial for displaying multiline messages */
    white-space: pre-wrap; 
}

/* User messages should be aligned right */
.user-msg { 
    background: #00c6ff66; 
    align-self: flex-end; 
    max-width: 80%;
}
/* AI messages should be aligned left */
.ai-msg   { 
    background: #4444ff55; 
    align-self: flex-start;
    max-width: 80%;
}

.input-area {
    display: flex;
    flex-direction: column;
}

textarea {
    width: 100%;
    padding: 10px;
    border-radius: 10px;
    /* Allow vertical resizing */
    resize: vertical;
    font-size: 15px;
    outline: none;
    border: none;
    min-height: 50px;
    max-height: 120px; /* Limits the size of the input box */
    /* Allows text to wrap and show new lines */
    white-space: pre-wrap; 
    overflow-y: auto; /* Enables scrolling for long input */
}

button {
    margin-top: 10px;
    padding: 12px;
    border-radius: 10px;
    border: none;
    background: #00c6ff;
    color: white;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
}
button:hover { background: #009edc; }

.loading { display: inline-block; }
.loading::after {
    content: '.';
    animation: dots 1s steps(5,end) infinite;
}
@keyframes dots { 0%,20%{content:'.';} 40%{content:'..';} 60%{content:'...';} 80%,100%{content:'.';} }

.clear-btn {
    margin-top: 5px;
    padding: 8px;
    border-radius: 8px;
    border: none;
    background: #ff5555;
    color: white;
    cursor: pointer;
    font-size: 14px;
}
.clear-btn:hover { background: #dd0000; }
</style>
</head>

<body>

<div class="container">
    <h1>ü§ñ VirginAI</h1>
    <div id="chat"></div>
    <div class="input-area">
        <textarea id="question" placeholder="Ask your question (Shift+Enter for new line)..." rows="3"></textarea>
    </div>
    <button id="ask-btn" onclick="askAI()">Ask</button>
    <button class="clear-btn" onclick="clearChat()">Clear Chat</button>
</div>

<script>
const chat = document.getElementById("chat");
const questionInput = document.getElementById("question");
const askButton = document.getElementById("ask-btn");

function appendMessage(msg, className){
    const div = document.createElement("div");
    div.className = className;
    // Use innerHTML to handle potential line breaks rendered as <br> or similar if needed, 
    // but with CSS 'white-space: pre-wrap' we can use textContent for security and simplicity.
    div.textContent = msg; 
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

async function askAI(){
    const question = questionInput.value.trim();
    if(!question) return;

    appendMessage(question, "user-msg");
    questionInput.value = "";
    
    // Disable the button while loading
    askButton.disabled = true;
    
    const loadingDiv = document.createElement("div");
    loadingDiv.className = "ai-msg loading";
    loadingDiv.textContent = "Thinking";
    chat.appendChild(loadingDiv);
    chat.scrollTop = chat.scrollHeight;

    try{
        const res = await fetch("/ask", {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body: JSON.stringify({question})
        });

        const data = await res.json();
        loadingDiv.remove();

        // Ensure the answer is a string and handle new lines in display
        appendMessage(data.answer, "ai-msg");
    } catch(err){
        loadingDiv.remove();
        appendMessage("üåê Network or server error.", "ai-msg");
    } finally {
        // Re-enable the button
        askButton.disabled = false;
    }
}

async function clearChat(){
    chat.innerHTML = "";
    try {
        await fetch("/clear-session", {method:"POST"});
    } catch (err) {
        appendMessage("Failed to clear server session.", "ai-msg");
    }
}

// --- New Line/Submission Logic ---
questionInput.addEventListener("keydown", function(event) {
    // Check if the user pressed Enter
    if (event.key === 'Enter') {
        // If Shift or Ctrl is pressed with Enter, allow the new line
        if (event.shiftKey || event.ctrlKey) {
            // Allow the default behavior (insert new line)
            return;
        } else {
            // Otherwise, prevent the default (new line) and submit the question
            event.preventDefault(); 
            askAI();
        }
    }
});
</script>

</body>
</html>
