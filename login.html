<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login | VirginAI</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Login to VirginAI">

<link rel="icon" href="/android-chrome-512x512.png">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#050505;
  --panel:#0c0c0c;
  --border:#1e1e1e;
  --gold:#c9a44a;
  --text:#eaeaea;
  --muted:#9a9a9a;
}
*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  background:var(--bg);
  font-family:Inter,Segoe UI,sans-serif;
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--text);
}

.card{
  width:100%;
  max-width:420px;
  background:linear-gradient(180deg,#0a0a0a,#0f0f0f);
  border:1px solid var(--border);
  border-radius:18px;
  padding:34px 28px;
  box-shadow:0 0 45px rgba(201,164,74,.08);
}

.brand{text-align:center;margin-bottom:24px}
.brand img{width:72px;border-radius:16px}
.brand h1{margin:10px 0 0;color:var(--gold);font-size:22px}
.brand p{margin-top:6px;font-size:13px;color:var(--muted)}

.input{margin-bottom:14px;position:relative}
.input label{font-size:13px;color:#bcbcbc;display:block;margin-bottom:6px}
.input input{
  width:100%;
  padding:12px 40px 12px 14px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#080808;
  color:var(--text);
  font-size:14px;
}
.input input:focus{border-color:var(--gold);outline:none}

.eye{
  position:absolute;
  right:12px;
  top:36px;
  cursor:pointer;
  color:#aaa;
}

.btn{
  width:100%;
  padding:13px;
  border-radius:14px;
  border:none;
  font-size:15px;
  font-weight:500;
  cursor:pointer;
}

.btn-main{
  background:linear-gradient(135deg,#c9a44a,#9f8740);
  color:#000;
}

.social{
  background:#000;
  border:1px solid var(--border);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  margin-bottom:10px;
}
.social img{width:18px}

.divider{text-align:center;margin:18px 0;font-size:12px;color:var(--muted)}

.footer{text-align:center;font-size:12px;color:var(--muted)}
.footer a{color:var(--gold);text-decoration:none}

.forgot{
  text-align:right;
  font-size:12px;
  margin-bottom:10px;
}
.forgot a{color:var(--gold);cursor:pointer}

.loader{
  display:none;
  width:22px;
  height:22px;
  border:3px solid #000;
  border-top:3px solid transparent;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:auto;
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div class="card">

  <div class="brand">
    <img src="/android-chrome-512x512.png">
    <h1>VirginAI</h1>
    <p>Login to your account</p>
  </div>

  <form id="loginForm">
    <div class="input">
      <label>Email</label>
      <input id="email" type="email" required>
    </div>

    <div class="input">
      <label>Password</label>
      <input id="password" type="password" required>
      <span class="eye" onclick="togglePass()">üëÅÔ∏è</span>
    </div>

    <div class="forgot">
      <a onclick="resetPassword()">Forgot password?</a>
    </div>

    <button class="btn btn-main">
      <span id="loginText">Login</span>
      <div class="loader" id="loginLoader"></div>
    </button>
  </form>

  <div class="divider">OR</div>

  <button class="btn social" id="googleBtn">
    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg">
    Continue with Google
  </button>

  <button class="btn social" id="appleBtn">
    <img src="https://upload.wikimedia.org/wikipedia/commons/3/31/Apple_logo_white.svg">
    Continue with Apple
  </button>

  <div class="footer">
    Don‚Äôt have an account?
    <a href="/signup.html">Create one</a>
  </div>

</div>


<script type="module">
import { auth } from "./firebase.js";
import { onAuthStateChanged } from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

onAuthStateChanged(auth, (user) => {
  if (user) {
    // Already logged in ‚Üí go to home
    location.replace("/index.html");
  }
});
</script>

<!-- FIREBASE LOGIC -->
<script type="module">
import { auth, db } from "./firebase.js";
import {
  signInWithEmailAndPassword,
  GoogleAuthProvider,
  OAuthProvider,
  signInWithPopup,
  sendPasswordResetEmail
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
  doc,
  setDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const loader=document.getElementById("loginLoader");
const text=document.getElementById("loginText");

function loading(on){
  loader.style.display=on?"block":"none";
  text.style.display=on?"none":"inline";
}

/* EMAIL LOGIN */
loginForm.addEventListener("submit", async (e)=>{
  e.preventDefault();
  loading(true);

  try{
    const cred = await signInWithEmailAndPassword(
      auth,
      email.value,
      password.value
    );

    await setDoc(doc(db,"users",cred.user.uid),
      { lastLogin: serverTimestamp() },
      { merge:true }
    );

    location.href="/";
  }catch(err){
    loading(false);
    if(err.code==="auth/wrong-password" || err.code==="auth/invalid-credential"){
      alert("‚ùå Wrong password");
    }else if(err.code==="auth/user-not-found"){
      alert("‚ùå Account not found");
    }else{
      alert("Login failed");
    }
  }
});

/* GOOGLE LOGIN */
googleBtn.onclick = async ()=>{
  try{
    const r = await signInWithPopup(auth,new GoogleAuthProvider());

    await setDoc(doc(db,"users",r.user.uid),{
      name:r.user.displayName || "",
      email:r.user.email || "",
      provider:"google",
      lastLogin:serverTimestamp()
    },{merge:true});

    location.href="/";
  }catch(e){
    alert("Google login failed");
  }
};

/* APPLE LOGIN */
appleBtn.onclick = async ()=>{
  try{
    const r = await signInWithPopup(auth,new OAuthProvider("apple.com"));

    await setDoc(doc(db,"users",r.user.uid),{
      name:r.user.displayName || "Apple User",
      email:r.user.email || "",
      provider:"apple",
      lastLogin:serverTimestamp()
    },{merge:true});

    location.href="/";
  }catch(e){
    alert("Apple login failed");
  }
};

/* RESET PASSWORD */
window.resetPassword = async ()=>{
  if(!email.value){
    alert("Enter your email first");
    return;
  }
  await sendPasswordResetEmail(auth,email.value);
  alert("Password reset email sent");
};

/* SHOW / HIDE PASSWORD */
window.togglePass = ()=>{
  password.type = password.type === "password" ? "text" : "password";
};
</script>
<script type="module" src="/auth.js"></script>
</body>
</html>